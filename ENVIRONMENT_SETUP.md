# HIMS - Environment Setup Guide

## Table of Contents
1. [Introduction](#introduction)
2. [Environment File (.env)](#environment-file-env)
3. [Configuration Groups](#configuration-groups)
4. [Development vs Production](#development-vs-production)
5. [Security Best Practices](#security-best-practices)
6. [Troubleshooting](#troubleshooting)

---

## Introduction

This guide provides comprehensive documentation for configuring the HIMS application using the `.env` environment file. The `.env` file contains all configuration variables needed to run the application.

---

## Environment File (.env)

### Creating the .env File

The `.env` file should be created from `.env.example`:

```bash
cp .env.example .env
```

After creating the file, you must generate an application key:

```bash
php artisan key:generate
```

---

## Configuration Groups

### 1. Application Configuration

#### APP_NAME
- **Description:** The name of your application
- **Default:** Laravel
- **Example:** `APP_NAME="HIMS"`
- **Usage:** Displayed in emails, notifications, and the application title

#### APP_ENV
- **Description:** The application environment
- **Values:** `local`, `development`, `staging`, `production`
- **Default:** local
- **Example:** `APP_ENV=production`
- **Important:** Set to `production` for live environments

#### APP_KEY
- **Description:** Application encryption key
- **Default:** (auto-generated)
- **Example:** `APP_KEY=base64:random_32_character_string`
- **Important:**
  - Generated by `php artisan key:generate`
  - NEVER share this key
  - Keep it secret and secure
  - DO NOT change after deployment (will break encrypted data)

#### APP_DEBUG
- **Description:** Enable/disable debug mode
- **Values:** `true`, `false`
- **Default:** true
- **Example:** `APP_DEBUG=false`
- **Important:**
  - MUST be `false` in production
  - Prevents sensitive error information from being displayed

#### APP_URL
- **Description:** The base URL of your application
- **Default:** http://localhost
- **Example:** `APP_URL=https://yourhospital.com`
- **Important:** Used for generating URLs in emails, notifications

#### APP_LOCALE
- **Description:** Default application language
- **Default:** en
- **Example:** `APP_LOCALE=en`
- **Options:** en, hi, etc.

#### APP_FALLBACK_LOCALE
- **Description:** Fallback language if translation is missing
- **Default:** en
- **Example:** `APP_FALLBACK_LOCALE=en`

#### APP_FAKER_LOCALE
- **Description:** Locale for fake data generation (testing)
- **Default:** en_US
- **Example:** `APP_FAKER_LOCALE=en_US`

---

### 2. Database Configuration

#### DB_CONNECTION
- **Description:** Database driver
- **Values:** `mysql`, `pgsql`, `sqlite`, `sqlsrv`
- **Default:** sqlite
- **Example:** `DB_CONNECTION=mysql`
- **Recommended:** mysql for production

#### DB_HOST
- **Description:** Database server host
- **Default:** 127.0.0.1
- **Example:** `DB_HOST=127.0.0.1`
- **Options:**
  - `127.0.0.1` for local database
  - `localhost` for local database (may use socket)
  - Remote IP for remote database server

#### DB_PORT
- **Description:** Database server port
- **Default:** 3306 (MySQL), 5432 (PostgreSQL)
- **Example:** `DB_PORT=3306`

#### DB_DATABASE
- **Description:** Name of the database
- **Default:** laravel
- **Example:** `DB_DATABASE=hims_production`
- **Important:** Create this database before running migrations

#### DB_USERNAME
- **Description:** Database user
- **Default:** root
- **Example:** `DB_USERNAME=hims_user`
- **Important:** Use dedicated user with limited privileges in production

#### DB_PASSWORD
- **Description:** Database password
- **Default:** (empty)
- **Example:** `DB_PASSWORD=secure_password_here`
- **Important:**
  - Use strong password
  - NEVER commit to version control
  - Different password for each environment

**MySQL Database Setup Example:**
```bash
# Create database
mysql -u root -p
CREATE DATABASE hims_production CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# Create dedicated user
CREATE USER 'hims_user'@'localhost' IDENTIFIED BY 'secure_password';

# Grant privileges
GRANT ALL PRIVILEGES ON hims_production.* TO 'hims_user'@'localhost';
FLUSH PRIVILEGES;
```

---

### 3. Logging Configuration

#### LOG_CHANNEL
- **Description:** Default log channel
- **Values:** `stack`, `single`, `daily`, `slack`, `syslog`, `errorlog`
- **Default:** stack
- **Example:** `LOG_CHANNEL=daily`
- **Recommended:** `daily` for production (rotates logs daily)

#### LOG_STACK
- **Description:** Channels to use when LOG_CHANNEL is stack
- **Default:** single
- **Example:** `LOG_STACK=daily`

#### LOG_DEPRECATIONS_CHANNEL
- **Description:** Channel for deprecation warnings
- **Default:** null
- **Example:** `LOG_DEPRECATIONS_CHANNEL=null`

#### LOG_LEVEL
- **Description:** Minimum log level to record
- **Values:** `debug`, `info`, `notice`, `warning`, `error`, `critical`, `alert`, `emergency`
- **Default:** debug
- **Example:** `LOG_LEVEL=error`
- **Recommended:** `error` or `warning` for production

---

### 4. Session Configuration

#### SESSION_DRIVER
- **Description:** Where to store session data
- **Values:** `file`, `cookie`, `database`, `memcached`, `redis`, `array`
- **Default:** database
- **Example:** `SESSION_DRIVER=database`
- **Recommended:**
  - `database` for single-server setups
  - `redis` for multi-server/load-balanced setups

#### SESSION_LIFETIME
- **Description:** Session lifetime in minutes
- **Default:** 120
- **Example:** `SESSION_LIFETIME=480` (8 hours)
- **Note:** User sessions expire after this duration of inactivity

#### SESSION_ENCRYPT
- **Description:** Encrypt session data
- **Values:** `true`, `false`
- **Default:** false
- **Example:** `SESSION_ENCRYPT=true`

#### SESSION_PATH
- **Description:** Session cookie path
- **Default:** /
- **Example:** `SESSION_PATH=/`

#### SESSION_DOMAIN
- **Description:** Session cookie domain
- **Default:** null
- **Example:** `SESSION_DOMAIN=.yourhospital.com`

---

### 5. Cache Configuration

#### CACHE_STORE
- **Description:** Default cache driver
- **Values:** `apc`, `array`, `database`, `file`, `memcached`, `redis`
- **Default:** database
- **Example:** `CACHE_STORE=redis`
- **Recommended:**
  - `database` or `file` for simple setups
  - `redis` for production/high-traffic

#### CACHE_PREFIX
- **Description:** Prefix for cache keys
- **Default:** (empty)
- **Example:** `CACHE_PREFIX=hims_`
- **Note:** Useful when sharing cache server with other apps

---

### 6. Queue Configuration

#### QUEUE_CONNECTION
- **Description:** Default queue driver
- **Values:** `sync`, `database`, `beanstalkd`, `sqs`, `redis`
- **Default:** database
- **Example:** `QUEUE_CONNECTION=database`
- **Important:**
  - `sync` for immediate execution (development)
  - `database` or `redis` for production
  - Requires queue worker: `php artisan queue:work`

---

### 7. Mail Configuration

#### MAIL_MAILER
- **Description:** Mail driver
- **Values:** `smtp`, `sendmail`, `mailgun`, `ses`, `postmark`, `log`, `array`
- **Default:** log
- **Example:** `MAIL_MAILER=smtp`

#### MAIL_HOST
- **Description:** SMTP server host
- **Default:** 127.0.0.1
- **Example:** `MAIL_HOST=smtp.gmail.com`

#### MAIL_PORT
- **Description:** SMTP server port
- **Default:** 2525
- **Common Ports:**
  - 587 (TLS)
  - 465 (SSL)
  - 25 (Unencrypted, not recommended)
- **Example:** `MAIL_PORT=587`

#### MAIL_USERNAME
- **Description:** SMTP username
- **Default:** null
- **Example:** `MAIL_USERNAME=youremail@gmail.com`

#### MAIL_PASSWORD
- **Description:** SMTP password
- **Default:** null
- **Example:** `MAIL_PASSWORD=your_app_password`
- **Gmail Note:** Use App Password, not account password

#### MAIL_FROM_ADDRESS
- **Description:** Default "from" email address
- **Default:** hello@example.com
- **Example:** `MAIL_FROM_ADDRESS=noreply@yourhospital.com`

#### MAIL_FROM_NAME
- **Description:** Default "from" name
- **Default:** ${APP_NAME}
- **Example:** `MAIL_FROM_NAME="HIMS - Hospital System"`

**Gmail SMTP Configuration Example:**
```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=youremail@gmail.com
MAIL_PASSWORD=your_16_char_app_password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@yourhospital.com
MAIL_FROM_NAME="${APP_NAME}"
```

---

### 8. Filesystem Configuration

#### FILESYSTEM_DISK
- **Description:** Default filesystem disk
- **Values:** `local`, `public`, `s3`
- **Default:** local
- **Example:** `FILESYSTEM_DISK=public`
- **Note:**
  - `local` - storage/app
  - `public` - storage/app/public (publicly accessible)
  - `s3` - Amazon S3

---

### 9. Broadcasting Configuration

#### BROADCAST_CONNECTION
- **Description:** Default broadcast driver
- **Values:** `log`, `pusher`, `redis`, `null`
- **Default:** log
- **Example:** `BROADCAST_CONNECTION=pusher`
- **Note:** Used for real-time features

---

### 10. Redis Configuration

#### REDIS_CLIENT
- **Description:** Redis client library
- **Values:** `phpredis`, `predis`
- **Default:** phpredis
- **Example:** `REDIS_CLIENT=phpredis`
- **Note:** phpredis is faster but requires PHP extension

#### REDIS_HOST
- **Description:** Redis server host
- **Default:** 127.0.0.1
- **Example:** `REDIS_HOST=127.0.0.1`

#### REDIS_PASSWORD
- **Description:** Redis password
- **Default:** null
- **Example:** `REDIS_PASSWORD=your_redis_password`

#### REDIS_PORT
- **Description:** Redis server port
- **Default:** 6379
- **Example:** `REDIS_PORT=6379`

---

### 11. AWS Configuration

#### AWS_ACCESS_KEY_ID
- **Description:** AWS access key
- **Default:** (empty)
- **Example:** `AWS_ACCESS_KEY_ID=your_access_key`

#### AWS_SECRET_ACCESS_KEY
- **Description:** AWS secret key
- **Default:** (empty)
- **Example:** `AWS_SECRET_ACCESS_KEY=your_secret_key`

#### AWS_DEFAULT_REGION
- **Description:** AWS region
- **Default:** us-east-1
- **Example:** `AWS_DEFAULT_REGION=ap-south-1`

#### AWS_BUCKET
- **Description:** S3 bucket name
- **Default:** (empty)
- **Example:** `AWS_BUCKET=hims-uploads`

---

### 12. Additional Configuration

#### BCRYPT_ROUNDS
- **Description:** Password hashing rounds
- **Default:** 12
- **Example:** `BCRYPT_ROUNDS=12`
- **Note:** Higher = more secure but slower

#### VITE_APP_NAME
- **Description:** App name for Vite build
- **Default:** ${APP_NAME}
- **Example:** `VITE_APP_NAME="${APP_NAME}"`

---

### 13. Custom Configuration (HIMS Specific)

#### ANTHROPIC_API_KEY
- **Description:** Claude AI API key for AI assistance
- **Default:** (empty)
- **Example:** `ANTHROPIC_API_KEY=sk-ant-api03-xxxxx`
- **Note:** Optional feature for AI-powered clinical assistance
- **Get Key:** https://console.anthropic.com/

---

## Development vs Production

### Development Environment (.env)

```env
APP_NAME="HIMS Development"
APP_ENV=local
APP_DEBUG=true
APP_URL=http://localhost:8000

DB_CONNECTION=sqlite
# OR for MySQL:
# DB_CONNECTION=mysql
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_DATABASE=hims_dev
# DB_USERNAME=root
# DB_PASSWORD=

LOG_CHANNEL=stack
LOG_LEVEL=debug

SESSION_DRIVER=file
CACHE_STORE=file
QUEUE_CONNECTION=sync

MAIL_MAILER=log

BROADCAST_CONNECTION=log
```

### Production Environment (.env)

```env
APP_NAME="HIMS"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://yourhospital.com

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=hims_production
DB_USERNAME=hims_user
DB_PASSWORD=very_secure_password_here

LOG_CHANNEL=daily
LOG_LEVEL=error

SESSION_DRIVER=database
SESSION_LIFETIME=480
CACHE_STORE=redis
QUEUE_CONNECTION=redis

REDIS_HOST=127.0.0.1
REDIS_PASSWORD=redis_secure_password
REDIS_PORT=6379

MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=hospital@yourdomain.com
MAIL_PASSWORD=app_specific_password
MAIL_FROM_ADDRESS=noreply@yourhospital.com
MAIL_FROM_NAME="HIMS Notification"

BROADCAST_CONNECTION=redis

# Optional
ANTHROPIC_API_KEY=sk-ant-api03-your-key-here
```

---

## Security Best Practices

### 1. Never Commit .env to Version Control

Add to `.gitignore`:
```
.env
.env.backup
.env.production
```

### 2. Use Different Keys Per Environment

- Generate new `APP_KEY` for each environment
- Never reuse production keys in development

### 3. Secure Database Credentials

- Use strong, unique passwords
- Create dedicated database users with minimal privileges
- Never use root user in production

### 4. Restrict Debug Mode

- Always set `APP_DEBUG=false` in production
- Debug mode reveals sensitive information

### 5. Use HTTPS

- Set `APP_URL` to https:// in production
- Configure force HTTPS in production

### 6. Regular Backups

- Backup database regularly
- Backup `.env` file securely (encrypted storage)

### 7. Environment-Specific Settings

- Different API keys per environment
- Different database per environment
- Different mail settings per environment

---

## Troubleshooting

### Issue: "No application encryption key has been specified"

**Solution:**
```bash
php artisan key:generate
```

### Issue: Database connection error

**Solutions:**
1. Verify database credentials in `.env`
2. Ensure database exists
3. Check database server is running
4. Test connection:
```bash
mysql -u username -p -h hostname database_name
```

### Issue: Mail not sending

**Solutions:**
1. Check SMTP credentials
2. For Gmail, use App Password
3. Test mail configuration:
```bash
php artisan tinker
Mail::raw('Test', function($msg) { $msg->to('test@example.com')->subject('Test'); });
```

### Issue: Session not persisting

**Solutions:**
1. If using database sessions, ensure sessions table exists:
```bash
php artisan session:table
php artisan migrate
```
2. Clear config cache:
```bash
php artisan config:clear
```

### Issue: Cache not working

**Solutions:**
1. If using Redis, ensure Redis is running:
```bash
redis-cli ping
```
2. Clear cache:
```bash
php artisan cache:clear
```

### Issue: Queue jobs not processing

**Solutions:**
1. Ensure queue worker is running:
```bash
php artisan queue:work
```
2. For production, use supervisor to keep worker running

---

## Environment Validation

### Check Configuration

```bash
# View all config
php artisan config:show

# View specific config
php artisan config:show database

# Test database connection
php artisan db:show

# Clear all caches
php artisan optimize:clear
```

### After Changing .env

Always run:
```bash
php artisan config:clear
```

In production, cache the config:
```bash
php artisan config:cache
```

---

## Sample .env Template for HIMS

```env
# Application
APP_NAME="HIMS - Hospital Information Management System"
APP_ENV=production
APP_KEY=base64:generate_using_artisan_key_generate
APP_DEBUG=false
APP_URL=https://yourhospital.com

# Database
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=hims_production
DB_USERNAME=hims_user
DB_PASSWORD=your_secure_database_password

# Logging
LOG_CHANNEL=daily
LOG_LEVEL=error

# Session & Cache
SESSION_DRIVER=database
SESSION_LIFETIME=480
CACHE_STORE=redis
QUEUE_CONNECTION=redis

# Redis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=your_redis_password
REDIS_PORT=6379

# Mail
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your_app_password
MAIL_FROM_ADDRESS=noreply@yourhospital.com
MAIL_FROM_NAME="${APP_NAME}"

# Filesystem
FILESYSTEM_DISK=public

# Broadcasting
BROADCAST_CONNECTION=redis

# AWS (if using S3)
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=ap-south-1
AWS_BUCKET=

# Claude AI (Optional)
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# Vite
VITE_APP_NAME="${APP_NAME}"
```

---

## Additional Resources

- [Laravel Configuration Documentation](https://laravel.com/docs/configuration)
- [Laravel Environment Configuration](https://laravel.com/docs/configuration#environment-configuration)
- [Laravel Database Configuration](https://laravel.com/docs/database)

---

**Document Version:** 1.0
**Last Updated:** February 2026
**Maintained By:** Development Team
